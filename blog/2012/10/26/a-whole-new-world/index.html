
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>A Whole New World - Dev and Such</title>
  <meta name="author" content="Brian Zwahr">

  
  <meta name="description" content="I started working at Improving this week which has required a major shift in my development ways. First and foremost is the change from PHP (which I& &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://echosa.github.io/blog/2012/10/26/a-whole-new-world">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Dev and Such" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Dev and Such</a></h1>
  
    <h2>A blog pertaining to my own development experiences.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="echosa.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/categories/php">PHP</a></li>
  <li><a href="/blog/categories/java">Java</a></li>
  <li><a href="/blog/categories/ios">iOS</a></li>
  <li><a href="/blog/categories/node-js">Node.js</a></li>
  <li><a href="/blog/categories/emacs">Emacs</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">A Whole New World</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2012-10-26T07:42:00-05:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>7:42 am</span></time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://echosa.github.io">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>I started working at <a href="http://improvingenterprises.com">Improving</a> this week which has required a major shift in my development ways. First and foremost is the change from PHP (which I&rsquo;ve been coding for <em>years</em>) to Java. It wouldn&rsquo;t be so bad if it was <em>just</em> Java, though. However, that is not the case.</p>

<!--more-->


<p>Oh no, that is not the case by a <em>long</em> shot. I&rsquo;ve been introduced to an entire new world consisting of jboss, maven, JSF, CDI, JPA, hibernate, and annotations, my God, the annotations!</p>

<p>Also Eclipse, but we won&rsquo;t go into that.</p>

<p>This past week has been such a head-stuffer that I&rsquo;m certain I&rsquo;ve lost some older, but valuable, information. (What&rsquo;s my wife&rsquo;s name again?) I&rsquo;m going to quickly go over my experiences with each of these technologies and illustrate what my one week&rsquo;s worth of experience has left me with. I&rsquo;ll be doing so in no particular order.</p>

<p>CDI is pretty straight-forward. It&rsquo;s dependency injection (hence the &ldquo;DI&rdquo;). As long as you understand annotations, you&rsquo;re good. The main ingredient is <code>@Inject</code>, which does exactly that. It injects a dependency into a class, like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">javax.inject.Inject</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyClass</span> <span class="o">{</span>
</span><span class='line'>    <span class="nd">@Inject</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">SomeObject</span> <span class="n">injectedObject</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">...</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This will instantiate <code>injectedObject</code> in the class so that it can be used in the class methods without any other preparation. Conceivably, you could then simply replace the SomeObject class with another in the class path and thus change what gets injected, for instance, a mock or stub class for testing purposes. This is made even easier (I think?) with some other annotations (like <code>@Qualifier</code>), which I won&rsquo;t get into this in this post.</p>

<p>JPA and hibernate I&rsquo;ll cover together because hibernate is an implementation of the Java Persistence API (does anyone else get a kick out of nested acronyms, or is it just me?). I should mention that I&rsquo;m working with hibernate 4 which, apparently, is significantly different from previous version from what I&rsquo;ve been told. Hibernate is an ORM and used, obviously, for database access. It can be used with or without the persistence stuff; I am developing with persistence.</p>

<p>Hibernate gave me a lot of trouble. At first it was easy, as I wrote my practice code in the &ldquo;old style&rdquo; using a config XML file. A couple hours of hacking away, and I was able to write to my database from my test application. Then I was told to convert that XML config file usage into annotations (which, humorously enough, require a <em>different</em> XML file). That&rsquo;s when all the trouble started.</p>

<p>I ran into many issues including:
* being told I need to wrap my calls to <code>persist()</code> (the method that inserts into the database) in transactions,
* doing so, and being told that transactions can&rsquo;t be used (this and the previous led to a recursive loop of one then the other as I tried to fix both problems)
* finally getting no errors but not having the data actually be inserted into the database
* figuring out which versions of certain imported items I needed (there are some duplicates in both the javax.persistence and javax.transaction namespaces)</p>

<p>The second bullet point above lead to lots of research which essentially ended in my realizing that in order to use the <code>@PersistenceContext</code> annotation, you have to have the object using it declared as an EJB (Enterprise Java Bean), like so:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">javax.ejb.EJB</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyClass</span> <span class="o">{</span>
</span><span class='line'>    <span class="nd">@EJB</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">SomeObject</span> <span class="n">objectThatPerformsCallsToPersist</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">...</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is needed in order to inject EntityManager into the class that needs to call persist, using the <code>@PersistenceContext</code> annotation, like so:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">javax.pesistence.*</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">javax.transaction.*</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">static</span> <span class="n">javax</span><span class="o">.</span><span class="na">transaction</span><span class="o">.</span><span class="na">TransactionAttributeType</span><span class="o">.</span><span class="na">REQUIRED</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Stateless</span>
</span><span class='line'><span class="nd">@Transaction</span><span class="o">(</span><span class="n">REQUIRED</span><span class="o">)</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SomeObject</span> <span class="o">{</span>
</span><span class='line'>    <span class="nd">@PersistenceContext</span><span class="o">(</span><span class="n">unit</span><span class="o">=</span><span class="s">&quot;unit-name&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">EntityManager</span> <span class="n">em</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addThing</span><span class="o">(</span><span class="n">thing</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">thing</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>You&rsquo;ll notice a few things here. We set transactions as required, which will wrap all database calls in transactions if they aren&rsquo;t already. This is for the first bullet point above. Second, we set as <code>@Stateless</code> in order to make this available to CDI (that&rsquo;s a whole different set of explanations). You&rsquo;ll see what we set the EntityManager to persist. I&rsquo;m <em>pretty sure</em> this means there&rsquo;s only one hanging around (we aren&rsquo;t recreating new ones every time we need one), but I <em>do</em> know that the <code>@PersistenceContext</code> essentially injects the EntityManger in. Also, you&rsquo;ll see the unit was set to some string. This must match a <code>&lt;persistence-unit&gt;</code> you&rsquo;ve set in persistence.xml.</p>

<p>Yeah, so that was the gist of how I got it working after about a day. Then I&rsquo;m told &ldquo;oh, you shouldn&rsquo;t need the <code>@EJB</code> annotation, so practice fixing/refactoring that out&rdquo;. So I did, taking about another half of a day and eventually breaking down and having my manager/superior type person help me out. Long story short, it turns out that <code>@PersistenceContext</code> requires <code>@EJB</code> in the mix, but <code>@PersistenceUnit</code> does not. So, changing the former to the latter lets you not need the <code>@EJB</code> annotation, also requiring some other changes.</p>

<p><em>Or so we thought.</em></p>

<p>The final result that ended up working without needing @EJB looks like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Named</span>
</span><span class='line'><span class="nd">@RequestScoped</span>
</span><span class='line'><span class="nd">@TransactionAttribute</span><span class="o">(</span><span class="n">REQUIRED</span><span class="o">)</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SomeAction</span> <span class="o">{</span>
</span><span class='line'>    <span class="nd">@Inject</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">ObjectPersister</span> <span class="n">persister</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">String</span> <span class="n">storedString</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">persister</span><span class="o">.</span><span class="na">addToDb</span><span class="o">(</span><span class="s">&quot;String to add.&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="n">storedString</span> <span class="o">=</span> <span class="s">&quot;String to store.&quot;</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>doSomething()</code> method is meant to be called from an HTML element (such as a button) via JSF. The <code>@Named</code> annotation allows the .xhtml file(s) to reference <code>{someAction.doSomething}</code>. <code>@RequestScoped</code> is the scoping I used for my test application. This is just a string that gets set then displayed in the web browser (explained later).</p>

<p>However, we need our <code>ObjectPersister</code> class;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">javax.persistence.*</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">javax.transaction.*</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">javax.ejb.*</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">static</span> <span class="n">javax</span><span class="o">.</span><span class="na">ejb</span><span class="o">.</span><span class="na">TransactionAttributeType</span><span class="o">.</span><span class="na">REQUIRED</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Stateless</span>
</span><span class='line'><span class="nd">@TransactionAttribute</span><span class="o">(</span><span class="n">REQUIRED</span><span class="o">)</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ObjectPersister</span> <span class="o">{</span>
</span><span class='line'>    <span class="nd">@PersistenceContext</span><span class="o">(</span><span class="n">unitName</span><span class="o">=</span><span class="s">&quot;my-unit&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">EntityManager</span> <span class="n">em</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">addToDb</span><span class="o">(</span><span class="n">String</span> <span class="n">stringToAdd</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">MyObject</span> <span class="n">myObject</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyObject</span><span class="o">(</span><span class="n">stringToAdd</span><span class="o">);</span>
</span><span class='line'>        <span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">myObject</span><span class="o">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">myObject</span><span class="o">.</span><span class="na">theString</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is similar to my example above. Fairly straight forward. However, we need our <code>MyObject</code> class:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">javax.persistence.*</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Entity</span>
</span><span class='line'><span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;quote&quot;</span><span class="o">)</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyObject</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
</span><span class='line'>    <span class="nd">@Id</span>
</span><span class='line'>    <span class="nd">@GeneratedValue</span>
</span><span class='line'>    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;id&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;theString&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">String</span> <span class="n">theString</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">MyObject</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">MyObject</span><span class="o">(</span><span class="n">String</span> <span class="n">str</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">theString</span> <span class="o">=</span> <span class="n">str</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTheString</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">theString</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTheString</span><span class="o">(</span><span class="n">String</span> <span class="n">str</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">theString</span> <span class="o">=</span> <span class="n">str</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This class is straight forward; it&rsquo;s basically just a bean. The <code>@Entity</code> annotation essentially labels it as a database object (single entry, sort of), and the <code>@Table</code> gives the database table name these objects should be written to. The rest is mostly self-explanatory.</p>

<p>Ah, but we&rsquo;re still missing a piece to the puzzle. Remember that &ldquo;unit&rdquo; from before? We need to define that, and we do so in our persistence.xml:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;persistence</span> <span class="na">xmlns=</span><span class="s">&quot;http://java.sun.com/xml/ns/persistence&quot;</span>
</span><span class='line'>             <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
</span><span class='line'>             <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd&quot;</span>
</span><span class='line'>             <span class="na">version=</span><span class="s">&quot;2.0&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;persistence-unit</span> <span class="na">name=</span><span class="s">&quot;my-unit&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;jta-data-source&gt;</span>java:jboss/datasources/MySqlDS<span class="nt">&lt;/jta-data-source&gt;</span>
</span><span class='line'>    <span class="nt">&lt;properties&gt;</span>
</span><span class='line'>      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;hibernate.dialect&quot;</span> <span class="na">value=</span><span class="s">&quot;org.hibernate.dialect.MySQLDialect&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;hibernate.hbm2ddl.auto&quot;</span> <span class="na">value=</span><span class="s">&quot;update&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;hibernate.show_sql&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/properties&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;/persistence-unit&gt;</span>
</span><span class='line'><span class="nt">&lt;/persistence&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>In this case, I&rsquo;m using MySql. The third property, when set to &ldquo;true&rdquo; will print all database queries that are run to jboss&#8217; console, which is good for debugging. See that <code>&lt;jta-data-source&gt;</code>? Yeah, we need that. Turns out that <em>that</em> needs to be defined in the jboss config (not an application specific config)! Here&rsquo;s an example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;datasources&gt;</span>
</span><span class='line'>    <span class="nt">&lt;datasource</span> <span class="na">jndi-name=</span><span class="s">&quot;java:jboss/datasources/MySqlDS&quot;</span> <span class="na">pool-name=</span><span class="s">&quot;MySqlDS&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;connection-url&gt;</span>jdbc:mysql://localhost:3306/quotes<span class="nt">&lt;/connection-url&gt;</span>
</span><span class='line'>        <span class="nt">&lt;driver&gt;</span>com.mysql<span class="nt">&lt;/driver&gt;</span>
</span><span class='line'>        <span class="nt">&lt;transaction-isolation&gt;</span>TRANSACTION_READ_COMMITTED<span class="nt">&lt;/transaction-isolation&gt;</span>
</span><span class='line'>        <span class="nt">&lt;pool&gt;</span>
</span><span class='line'>            <span class="nt">&lt;min-pool-size&gt;</span>10<span class="nt">&lt;/min-pool-size&gt;</span>
</span><span class='line'>            <span class="nt">&lt;max-pool-size&gt;</span>100<span class="nt">&lt;/max-pool-size&gt;</span>
</span><span class='line'>            <span class="nt">&lt;prefill&gt;</span>true<span class="nt">&lt;/prefill&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/pool&gt;</span>
</span><span class='line'>        <span class="nt">&lt;security&gt;</span>
</span><span class='line'>            <span class="nt">&lt;user-name&gt;</span>username<span class="nt">&lt;/user-name&gt;</span>
</span><span class='line'>            <span class="nt">&lt;password&gt;</span>password<span class="nt">&lt;/password&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/security&gt;</span>
</span><span class='line'>        <span class="nt">&lt;statement&gt;</span>
</span><span class='line'>            <span class="nt">&lt;prepared-statement-cache-size&gt;</span>32<span class="nt">&lt;/prepared-statement-cache-size&gt;</span>
</span><span class='line'>            <span class="nt">&lt;share-prepared-statements&gt;</span>true<span class="nt">&lt;/share-prepared-statements&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/statement&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/datasource&gt;</span>
</span><span class='line'>    <span class="nt">&lt;drivers&gt;</span>
</span><span class='line'>        <span class="nt">&lt;driver</span> <span class="na">name=</span><span class="s">&quot;com.mysql&quot;</span> <span class="na">module=</span><span class="s">&quot;com.mysql&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;xa-datasource-class&gt;</span>com.mysql.jdbc.jdbc2.optional.MysqlXADataSource<span class="nt">&lt;/xa-datasource-class&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/driver&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/drivers&gt;</span>
</span><span class='line'><span class="nt">&lt;/datasources&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>You&rsquo;ll need to add these to your <code>&lt;datasources&gt;</code> and its <code>&lt;drivers&gt;</code> section. I added them to jboss&#8217; standalone.xml, but apparently you can add them to a domain-specific config as well.</p>

<p>Now we only have one more thing. Since I&rsquo;m using maven, I need to add the appropriated dependencies to my pom.xml file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;dependencies&gt;</span>
</span><span class='line'>   <span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>     <span class="nt">&lt;groupId&gt;</span>javax.persistence<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>     <span class="nt">&lt;artifactId&gt;</span>persistence-api<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>     <span class="nt">&lt;version&gt;</span>1.0-rev-1<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>   <span class="nt">&lt;/dependency&gt;</span>
</span><span class='line'>
</span><span class='line'>   <span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>     <span class="nt">&lt;groupId&gt;</span>javax.transaction<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>     <span class="nt">&lt;artifactId&gt;</span>jta<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>     <span class="nt">&lt;version&gt;</span>1.1<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>   <span class="nt">&lt;/dependency&gt;</span>
</span><span class='line'><span class="nt">&lt;/dependencies&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Add these to your <code>&lt;dependencies&gt;</code> tag.</p>

<p>After all of this, you <em>should</em> be set! The only thing missing is the .xhtml file to use the action from above, but I&rsquo;ll get to that below.</p>

<p><em>Whew</em> Moving on&hellip;</p>

<p>Since I&rsquo;ve mentioned them, jboss and maven are just part of the architecture. jboss is the server and maven acts as both a builder (like make) and a dependency manager. Not much else to say right now.</p>

<p>Finally, we get to JSF: Java Server Faces (I believe). This, from what I can tell, is a templating engine to let your .xhtml files access your Java classes (via the <code>@Named</code> annotation as mentioned).</p>

<p>Here&rsquo;s the missing example from our code/setup above:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span>
</span><span class='line'><span class="cp">   &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span>
</span><span class='line'><span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span>
</span><span class='line'>   <span class="na">xmlns:ui=</span><span class="s">&quot;http://java.sun.com/jsf/facelets&quot;</span>
</span><span class='line'>   <span class="na">xmlns:h=</span><span class="s">&quot;http://java.sun.com/jsf/html&quot;</span>
</span><span class='line'>   <span class="na">xmlns:f=</span><span class="s">&quot;http://java.sun.com/jsf/core&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;h:head&gt;</span>
</span><span class='line'><span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html; charset=iso-8859-1&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;title&gt;</span>My App<span class="nt">&lt;/title&gt;</span>
</span><span class='line'><span class="nt">&lt;/h:head&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;body&gt;</span>
</span><span class='line'>   <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;content&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h:form</span> <span class="na">id=</span><span class="s">&quot;myForm&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;h:commandButton</span> <span class="na">id=</span><span class="s">&quot;myButton&quot;</span> <span class="na">value=</span><span class="s">&quot;Click Me&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;f:ajax</span> <span class="na">event=</span><span class="s">&quot;click&quot;</span> <span class="na">render=</span><span class="s">&quot;targetElement&quot;</span> <span class="na">listener=</span><span class="s">&quot;#{someAction.doSomething}&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/h:commandButton&gt;</span>
</span><span class='line'>          <span class="nt">&lt;h:outputText</span> <span class="na">value=</span><span class="s">&quot;#{someAction.storedString}&quot;</span> <span class="na">id=</span><span class="s">&quot;targetElement&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/h:form&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>   <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>So, what we have here is a button that runs the <code>someAction.doSomething()</code> method, the renders the <code>targetElement</code> element when it is done. The <code>targetElement</code> has a value equal to whatever <code>someAction.storedString</code> is, so when <code>someAction.doSomething()</code> changes its value and tells <code>targetElement</code> to render, the value displayed in the browser changes to the new value set in the class. JSF provides the <code>#{}</code> interface between xhtml and Java classes.</p>

<hr />


<p>I&rsquo;ll be honest, my biggest issue and the reason it took me almost two days to do what I did is old information on the Internet. We are using basically the latest and greatest, so I had to make sure that the information I was reading was jboss 7, hibernate 4, etc. Wading through all the old stuff wasn&rsquo;t easy, though search filters helped. Also, we don&rsquo;t use Spring so I had to make sure I added &ldquo;-spring&rdquo; to my searches, especially when looking up persistence and transaction things.</p>

<p>Once you&rsquo;ve filtered out all the crud, then you find the mess: several different posts showing you several different ways to achieve a particular goal. If you&rsquo;re like me, none of them will work right, and you&rsquo;ll be left picking out the pieces of each that do and trying to smash them together into something coherent that works. (Then, if you&rsquo;re <em>really</em> like me, you fail, get frustrated, and ask for help.) However, the entire experience, though frustrating, leaves you with much more knowledge than you had before.</p>

<p>Well, that&rsquo;s all for now. Hopefully I&rsquo;ll be able to put my newly-obtained information to good use.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Brian Zwahr</span></span>

      




<time class='entry-date' datetime='2012-10-26T07:42:00-05:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>7:42 am</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/java/'>java</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://echosa.github.io/blog/2012/10/26/a-whole-new-world/" data-via="echosa" data-counturl="http://echosa.github.io/blog/2012/10/26/a-whole-new-world/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/10/16/combining-blogs/" title="Previous Post: Combining Blogs">&laquo; Combining Blogs</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/12/04/os-x-text-substitution/" title="Next Post: OS X Text Substitution">OS X Text Substitution &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>About Brian</h1>
  Brian has been programming since learning BASIC back in grade school. Having programmed PHP for Texas A&amp;M University for almost 5 years, he is now a Consultant at <a href="http://www.improvingenterprises.com">Improving Enterprises</a> where he mostly writes Java.
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/01/12/software-freedom/">Software Freedom</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/12/gopher-php-update/">Gopher-php and Phlog Update</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/06/lets-try-acme-episode-9-the-end/">Let&#8217;s Try Acme: Episode 9 - the End</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/06/new-and-improved-emacs-config/">New and Improved Emacs Config!</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/08/26/lets-try-acme-episode-8-scrolling-and-plumbing/">Let&#8217;s Try Acme: Episode 8 - Scrolling and Plumbing</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Presentations</h1>
  You can view slides from presentations I&#8217;ve given <a href="https://speakerdeck.com/echosa">here on Speaker Deck</a>.
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/echosa">@echosa</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'echosa',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/echosa" class="twitter-follow-button" data-show-count="false">Follow @echosa</a>
  
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Brian Zwahr -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'devstuff-blog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://echosa.github.io/blog/2012/10/26/a-whole-new-world/';
        var disqus_url = 'http://echosa.github.io/blog/2012/10/26/a-whole-new-world/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
