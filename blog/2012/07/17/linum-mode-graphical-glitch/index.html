
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Linum-mode Graphical Glitch Fix/workaround - Dev and Such</title>
  <meta name="author" content="Brian Zwahr">

  
  <meta name="description" content="So, if you use graphical emacs on Mac OS X and you also use linum-mode (to show the line numbers in the left part of a window), you have probably &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://echosa.github.io/blog/2012/07/17/linum-mode-graphical-glitch">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Dev and Such" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Dev and Such</a></h1>
  
    <h2>A blog pertaining to my own development experiences.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="echosa.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/categories/php">PHP</a></li>
  <li><a href="/blog/categories/java">Java</a></li>
  <li><a href="/blog/categories/clojure">Clojure</a></li>
  <li><a href="/blog/categories/ios">iOS</a></li>
  <li><a href="/blog/categories/node-js">Node.js</a></li>
  <li><a href="/blog/categories/emacs">Emacs</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Linum-mode Graphical Glitch Fix/workaround</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2012-07-17T11:46:00-05:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>11:46 am</span></time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://echosa.github.io">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>So, if you use graphical emacs on Mac OS X and you also use linum-mode (to show the line numbers in the left part of a window), you have probably noticed that there is a bit of a graphical glitch. To see what I&rsquo;m talking about, look at the image that is linked <a href="http://i.imgur.com/mt28I.png">here</a>. There is <a href="http://emacswiki.org/emacs/LineNumbers#toc5">some discussion</a> on EmacsWiki, but I didn&rsquo;t find an appropriate solution for myself.</p>

<!--more-->


<p>The issue is with a discrepancy between the left fringe and the linum-mode display. I guess the fringe puts a small border around itself, which overlaps the linum-mode display, creating the glitch. Since the fringe stuff is in the C source, its not easily or dynamically fixable.</p>

<p>That didn&rsquo;t stop me from figuring out my own solution, however. In reading the EmacsWiki notes, people suggested making changes to <code>linum-format</code>, which is customizable. Already that sounds good to me. However, there were a few issues with the solutions people posted. Either you had to set a static width (which I didn&rsquo;t want), or do some things that removed the right-justification (which I want) and the extra space between the line numbers and the buffer text (which I also want).</p>

<p>So, the first step was to get rid of the glitch. The best way I could come up with was to simply get rid of the left side fringe by using M-x fringe-mode and setting it to right-only. This removes the offending fringe on the left side, but leaves the right fringe, which is used for notification of wrapped lines, for instance. If you actually make use of the left fringe, obviously this part is not a solution for you, but it works for me (for now, anyway).</p>

<p>Then I had to get my line numbers displaying the way I wanted them to. The aforementioned <code>linum-format</code> can take a function as its value, so I came up with the following function:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='cl'><span class='line'><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">line</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="nv">propertize</span>
</span><span class='line'>   <span class="p">(</span><span class="nb">format</span> <span class="p">(</span><span class="nv">concat</span> <span class="s">&quot;%&quot;</span>
</span><span class='line'>                   <span class="p">(</span><span class="nv">number-to-string</span>
</span><span class='line'>                    <span class="p">(</span><span class="nb">length</span> <span class="p">(</span><span class="nv">number-to-string</span>
</span><span class='line'>                             <span class="p">(</span><span class="nv">line-number-at-pos</span> <span class="p">(</span><span class="nv">point-max</span><span class="p">)))))</span>
</span><span class='line'>                   <span class="s">&quot;d &quot;</span><span class="p">)</span>
</span><span class='line'>           <span class="nv">line</span><span class="p">)</span>
</span><span class='line'>   <span class="ss">&#39;face</span> <span class="ss">&#39;linum</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Put simply, this function finds out how many lines there are in the buffer, then uses that display the current line number, meeting the following criteria:</p>

<ul>
<li>The face is set the same as the normal fringe face (which, in my case, happens to be the default for the <code>linum</code> face). Without the call to properties, the line numbers take on whatever face that particular line has, which makes them inconsistent and distracting.</li>
<li>All the displayed line numbers have the same width. This is important, because its easy to get linum-mode to shrink to the size of the line number, meaning line 1 will end up being longer than, for instance, like 1000, because the line number display will be wider at line 1000 than line 1.</li>
<li>The line numbers are right justified.</li>
<li>There is an extra space between the line numbers and the buffer text <em>that is the same face as the line numbers</em>. There are other solutions out there to get the extra space, but all the ones I tried had the extra space the same face as the buffer, which I didn&rsquo;t like at all. In fact, the only difference really between setting <code>linum-format</code> to my function, and setting it to dynamic is this extra space.</li>
</ul>


<p>As I said, the only reason this works for me is because I&rsquo;m ok not having a fringe on the left side. If you must have that fringe, you can still use the function above to format your line numbers, but you&rsquo;ll still have the graphical glitch.</p>

<p>Also, its worth noting that I made the function anonymous (a lambda function) because I have that function directly inserted into the customize value for <code>linum-format</code>. You could just as easily define that function with a defun in your .emacs or some other file, then set the function name (whatever you call it) as the value for <code>linum-format</code>.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Brian Zwahr</span></span>

      




<time class='entry-date' datetime='2012-07-17T11:46:00-05:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>11:46 am</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/emacs/'>emacs</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://echosa.github.io/blog/2012/07/17/linum-mode-graphical-glitch/" data-via="echosa" data-counturl="http://echosa.github.io/blog/2012/07/17/linum-mode-graphical-glitch/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/07/13/ansi-term-vs-shell-mongodb/" title="Previous Post: ansi-term vs shell: mongodb">&laquo; ansi-term vs shell: mongodb</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/07/17/mac-os-x-screen-locking/" title="Next Post: Mac OS X Screen Locking Made Easy">Mac OS X Screen Locking Made Easy &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Presentations</h1>
  You can view slides from presentations I&#8217;ve given <a href="https://speakerdeck.com/echosa">here on Speaker Deck</a>.
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/echosa">@echosa</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'echosa',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/echosa" class="twitter-follow-button" data-show-count="false">Follow @echosa</a>
  
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Brian Zwahr -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'devstuff-blog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://echosa.github.io/blog/2012/07/17/linum-mode-graphical-glitch/';
        var disqus_url = 'http://echosa.github.io/blog/2012/07/17/linum-mode-graphical-glitch/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
