<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Behat | Dev and Such]]></title>
  <link href="http://echosa.github.io/blog/categories/behat/atom.xml" rel="self"/>
  <link href="http://echosa.github.io/"/>
  <updated>2015-01-13T08:50:56-06:00</updated>
  <id>http://echosa.github.io/</id>
  <author>
    <name><![CDATA[Brian Zwahr]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[PHP and Chmod]]></title>
    <link href="http://echosa.github.io/blog/2012/09/27/php-and-chmod/"/>
    <updated>2012-09-27T09:11:00-05:00</updated>
    <id>http://echosa.github.io/blog/2012/09/27/php-and-chmod</id>
    <content type="html"><![CDATA[<p>So, here&rsquo;s a tip that would have saved me about 10 minutes of frustrated work today. As <a href="http://php.net/manual/en/function.chmod.php">clearly stated in the PHP manual</a>, when you&rsquo;re setting the mode for a file via a number, the number must be expressed as octal. What this means is that the leading zero that is typically implicit when using chmod from the command like (e.g. <code>chmod 777 &lt;file&gt;</code>) is <strong>not</strong> implicit when calling chmod from PHP. You have to supply the leading zero, meaning you call something like <code>chmod(&lt;file&gt;, 0777)</code>.</p>

<!--more-->


<p>Now, you might be wondering why someone would be calling chmod from PHP anyway. I know I would be. Well, I&rsquo;m doing so for testing purposes. I have begun using <a href="http://behat.org">Behat with the Mink extension</a> for behavioral testing. I have an sqlite database that gets used with test data for these tests (the actual application uses MySQL, and yes, keeping those two in sync is a pain, especially when triggers are involved, but I digress).</p>

<p>Anyway, because of the way Behat works in conjunction with my running Apache/PHP/application setup, I didn&rsquo;t see a way of hooking into Behat in such a way where I could tell the database to run everything in throw away transactions in order to keep my database clean and as expected for each test scenario. Therefore, I simply hooked into Behat before each scenario to copy my pristine test database to a backup, then after each scenario copy it back, essentially rolling back any transactions that occurred during that scenario.</p>

<p>This may not be the best way to do it, but its what I figured out and its working for me, for now at least. Luckily, this is a well established application and the database doesn&rsquo;t change, so the mysql <-> sqlite syncing is a null issue for the foreseeable future.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Confused About Using BEHAT With ACLs (and ACLs in General)]]></title>
    <link href="http://echosa.github.io/blog/2012/07/03/confused-about-using-behat-with-acls/"/>
    <updated>2012-07-03T12:54:00-05:00</updated>
    <id>http://echosa.github.io/blog/2012/07/03/confused-about-using-behat-with-acls</id>
    <content type="html"><![CDATA[<p>A bit of disclosure before I begin. I&rsquo;m completely new to behat, so I have little knowledge of it beyond what little bit of work I&rsquo;ve done with ecukes (which is basically Cucumber for Emacs). That said, I&rsquo;m trying to setup behat to test various parts of a web application I am writing. Specifically, I have a really, really long form that I&rsquo;m tired of manually filling out and submitting in the browser. However, I believe I&rsquo;m running into an issue accessing the form&rsquo;s page in the first place.</p>

<!-- more -->


<p>The application is using Zend Framework 1.11, and with that I&rsquo;m using Zend_Acl and Zend_Navigation to auto-generate menus and breadcrumbs, as well as restrict access to parts of the application via ACL roles. Its the latter that I believe is causing me issues. What happens in the application is whenever a page is requested, the application looks at the currently logged in user (stored in the session) and retrieves the user&rsquo;s role. The role is then checked against the Zend_Navigation config, which assigns a resource to every page. This user role and page resource are checked with the ACL to find out whether or not the role is allowed rights to the resources. Basically, all basic ACL stuff.</p>

<p>So, to my concern. I need a way to let behat run the page with the form, which of course requires a particular ACL level. My first question is should I be checking my ACL at a different time/level of the application? By this, I mean to say should I make it so that the controller action itself can be reached no matter what (thus, freely available to behat), but somehow deny actual users access, menu items, etc. another way?</p>

<p>My second question is, if the application remains the way it is, what is the best way to &ldquo;log a user in&rdquo; via behat. I&rsquo;m assuming I should make a step definition that creates a user object with a certain role and adds that to the session. Fair enough. However, due to some bad coupling that I can&rsquo;t handle just now (but will handle soon-ish), I need more than just my user model. Which brings me to&hellip;</p>

<p>How do I set up my autoloading in Behat? When I simply require_once for my user model, the other classes can&rsquo;t be found (obviously).</p>

<p>So, I will continue investigating this issue, but please, if you have any useful information for me, comment or contact me in some other way (if you have the means). I&rsquo;d really like to get this underway to improve my life just a little bit.</p>
]]></content>
  </entry>
  
</feed>
